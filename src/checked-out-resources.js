"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const nodeFetch = require('node-fetch');
const tough = require('tough-cookie');
const node_html_parser_1 = require("node-html-parser");
const llcoopUrl = (pathAndQuery) => "https://sam.llcoop.org" + pathAndQuery;
const getCheckedOutItems = async (cred) => {
    const url = llcoopUrl("/patroninfo");
    const fetch = require('fetch-cookie/node-fetch')(nodeFetch, new tough.CookieJar());
    const response = await fetch(url, { method: "POST", body: `code=${cred.barcode}&pin=${cred.pin}`, headers: { "Content-Type": "application/x-www-form-urlencoded" } });
    const text = await response.text();
    const match = /\/patroninfo\~S\d+\/\d+\/items/ig.exec(text);
    if (match) {
        const itemsUrl = llcoopUrl(match[0]);
        const itemsResponse = await fetch(itemsUrl);
        const root = node_html_parser_1.parse(await itemsResponse.text());
        var result = root.querySelectorAll("tr.patFuncEntry").map((row) => {
            const get = (clazz) => {
                const selector = row.querySelector(clazz);
                return selector ? selector.structuredText : null;
            };
            const getAtt = (clazz, att) => {
                const selector = row.querySelector(clazz);
                return selector && selector.attributes ? selector.attributes[att] : null;
            };
            const renewed = get(".patFuncRenewCount");
            const { title, acknowledgements } = splitTitleAndAcknowledgements(get(".patFuncTitleMain"));
            return {
                who: cred.name,
                title,
                acknowledgements,
                image: generateImageUrl(getAtt(".patFuncTitle a", "href")),
                status: get(".patFuncStatus").replace(renewed, "").replace(/(\d\d-\d\d)-(\d\d)/, "20$2-$1").trim(),
                renewed,
            };
        });
        result.sort((a, b) => a.status < b.status ? -1 : (a.status === b.status ? 0 : 1));
        return result;
    }
    return [];
};
exports.handler = async (event = {}) => {
    if (!event.body) {
        return { statusCode: 400, body: 'invalid request, you are missing the parameter body' };
    }
    const args = JSON.parse(event.body);
    const response = { results: new Array(args.credentials.length) };
    try {
        await Promise.all(args.credentials.map(async (cred, i) => {
            const x = await getCheckedOutItems(cred);
            response.results[i] = x;
        }));
        const flat = response.results.reduce((a, b) => a.concat(b), []);
        return { statusCode: 200, body: JSON.stringify({ results: flat }) };
    }
    catch (err) {
        return { statusCode: 500, body: JSON.stringify(err) };
    }
};
function generateImageUrl(href) {
    if (href) {
        var matches = /\/record=([a-zA-Z0-9]+)~/.exec(href);
        if (matches) {
            return llcoopUrl("/bookjacket?recid=" + matches[1]);
        }
    }
    return null;
}
function splitTitleAndAcknowledgements(s) {
    const slash = s.indexOf(" / ");
    if (slash >= 0) {
        return {
            title: s.substring(0, slash),
            acknowledgements: s.substring(slash + 3).split(" ; ")
        };
    }
    return { title: s };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tlZC1vdXQtcmVzb3VyY2VzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2hlY2tlZC1vdXQtcmVzb3VyY2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3hDLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUN0Qyx1REFBeUM7QUFFekMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxZQUFvQixFQUFFLEVBQUUsQ0FBQyx3QkFBd0IsR0FBRyxZQUFZLENBQUM7QUFFcEYsTUFBTSxrQkFBa0IsR0FBRyxLQUFLLEVBQUUsSUFBdUIsRUFBRSxFQUFFO0lBQzNELE1BQU0sR0FBRyxHQUFHLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUNyQyxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQyxTQUFTLEVBQUUsSUFBSSxLQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztJQUNuRixNQUFNLFFBQVEsR0FBRyxNQUFNLEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLElBQUksQ0FBQyxPQUFPLFFBQVEsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxFQUFDLGNBQWMsRUFBQyxtQ0FBbUMsRUFBQyxFQUFFLENBQUMsQ0FBQztJQUNuSyxNQUFNLElBQUksR0FBRyxNQUFNLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNuQyxNQUFNLEtBQUssR0FBRyxrQ0FBa0MsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUQsSUFBSSxLQUFLLEVBQUU7UUFDVCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFckMsTUFBTSxhQUFhLEdBQUcsTUFBTSxLQUFLLENBQUMsUUFB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QyxLQUFLLENBQUMsS0FBSyxDQUFDO1NBQ3RELENBQUM7S0FDSDtJQUNELE9BQU8sRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUM7QUFDdEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG5vZGVGZXRjaCA9IHJlcXVpcmUoJ25vZGUtZmV0Y2gnKTtcclxuY29uc3QgdG91Z2ggPSByZXF1aXJlKCd0b3VnaC1jb29raWUnKTtcclxuaW1wb3J0IHsgcGFyc2UgfSBmcm9tICdub2RlLWh0bWwtcGFyc2VyJztcclxuXHJcbmNvbnN0IGxsY29vcFVybCA9IChwYXRoQW5kUXVlcnk6IHN0cmluZykgPT4gXCJodHRwczovL3NhbS5sbGNvb3Aub3JnXCIgKyBwYXRoQW5kUXVlcnk7XHJcblxyXG5jb25zdCBnZXRDaGVja2VkT3V0SXRlbXMgPSBhc3luYyAoY3JlZDogTExDb29wQ3JlZGVudGlhbHMpID0+IHtcclxuICBjb25zdCB1cmwgPSBsbGNvb3BVcmwoXCIvcGF0cm9uaW5mb1wiKTtcclxuICBjb25zdCBmZXRjaCA9IHJlcXVpcmUoJ2ZldGNoLWNvb2tpZS9ub2RlLWZldGNoJykobm9kZUZldGNoLCBuZXcgdG91Z2guQ29va2llSmFyKCkpO1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7IG1ldGhvZDogXCJQT1NUXCIsIGJvZHk6IGBjb2RlPSR7Y3JlZC5iYXJjb2RlfSZwaW49JHtjcmVkLnBpbn1gLCBoZWFkZXJzOiB7XCJDb250ZW50LVR5cGVcIjpcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwifSB9KTtcclxuICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xyXG4gIGNvbnN0IG1hdGNoID0gL1xcL3BhdHJvbmluZm9cXH5TXFxkK1xcL1xcZCtcXC9pdGVtcy9pZy5leGVjKHRleHQpO1xyXG4gIGlmIChtYXRjaCkge1xyXG4gICAgY29uc3QgaXRlbXNVcmwgPSBsbGNvb3BVcmwobWF0Y2hbMF0pO1xyXG5cclxuICAgIGNvbnN0IGl0ZW1zUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChpdGVtc1VybCk7XHJcbiAgICBjb25zdCByb290ID0gcGFyc2UoYXdhaXQgaXRlbXNSZXNwb25zZS50ZXh0KCkpO1xyXG5cclxuICAgIHZhciByZXN1bHQgOiBbXSA9IChyb290IGFzIGFueSkucXVlcnlTZWxlY3RvckFsbChcInRyLnBhdEZ1bmNFbnRyeVwiKS5tYXAoKHJvdzphbnkpID0+IHtcclxuICAgICAgY29uc3QgZ2V0ID0gKGNsYXp6OnN0cmluZykgOiBzdHJpbmcgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdG9yID0gcm93LnF1ZXJ5U2VsZWN0b3IoY2xhenopO1xyXG4gICAgICAgIHJldHVybiBzZWxlY3RvciA/IHNlbGVjdG9yLnN0cnVjdHVyZWRUZXh0IDogbnVsbDtcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgZ2V0QXR0ID0gKGNsYXp6OnN0cmluZywgYXR0OnN0cmluZykgOiBzdHJpbmcgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdG9yID0gcm93LnF1ZXJ5U2VsZWN0b3IoY2xhenopO1xyXG4gICAgICAgIHJldHVybiBzZWxlY3RvciAmJiBzZWxlY3Rvci5hdHRyaWJ1dGVzID8gc2VsZWN0b3IuYXR0cmlidXRlc1thdHRdIDogbnVsbDtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlbmV3ZWQgPSBnZXQoXCIucGF0RnVuY1JlbmV3Q291bnRcIik7XHJcblxyXG4gICAgICBjb25zdCB7IHRpdGxlLCBhY2tub3dsZWRnZW1lbnRzIH0gPSBzcGxpdFRpdGxlQW5kQWNrbm93bGVkZ2VtZW50cyhnZXQoXCIucGF0RnVuY1RpdGxlTWFpblwiKSk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHdobzogY3JlZC5uYW1lLFxyXG4gICAgICAgIHRpdGxlLFxyXG4gICAgICAgIGFja25vd2xlZGdlbWVudHMsXHJcbiAgICAgICAgaW1hZ2U6IGdlbmVyYXRlSW1hZ2VVcmwoZ2V0QXR0KFwiLnBhdEZ1bmNUaXRsZSBhXCIsIFwiaHJlZlwiKSksXHJcbiAgICAgICAgc3RhdHVzOiBnZXQoXCIucGF0RnVuY1N0YXR1c1wiKS5yZXBsYWNlKHJlbmV3ZWQsIFwiXCIpLnJlcGxhY2UoLyhcXGRcXGQtXFxkXFxkKS0oXFxkXFxkKS8sIFwiMjAkMi0kMVwiKS50cmltKCksXHJcbiAgICAgICAgcmVuZXdlZCxcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJlc3VsdC5zb3J0KChhOmFueSwgYjphbnkpID0+IGEuc3RhdHVzIDwgYi5zdGF0dXMgPyAtMSA6IChhLnN0YXR1cyA9PT0gYi5zdGF0dXMgPyAwIDogMSkpO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG4gIHJldHVybiBbXTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gYXN5bmMgKGV2ZW50OiBhbnkgPSB7fSkgOiBQcm9taXNlIDxhbnk+ID0+IHtcclxuICBpZiAoIWV2ZW50LmJvZHkpIHtcclxuICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDQwMCwgYm9keTogJ2ludmFsaWQgcmVxdWVzdCwgeW91IGFyZSBtaXNzaW5nIHRoZSBwYXJhbWV0ZXIgYm9keScgfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGFyZ3MgPSBKU09OLnBhcnNlKGV2ZW50LmJvZHkpO1xyXG4gIGNvbnN0IHJlc3BvbnNlID0geyByZXN1bHRzOiBuZXcgQXJyYXkoYXJncy5jcmVkZW50aWFscy5sZW5ndGgpIH07XHJcblxyXG4gIHRyeSB7XHJcbiAgICBhd2FpdCBQcm9taXNlLmFsbChcclxuICAgICAgYXJncy5jcmVkZW50aWFscy5tYXAoYXN5bmMgKGNyZWQ6IExMQ29vcENyZWRlbnRpYWxzLCBpOiBudW1iZXIpID0+IHtcclxuICAgICAgICBjb25zdCB4ID0gYXdhaXQgZ2V0Q2hlY2tlZE91dEl0ZW1zKGNyZWQpO1xyXG4gICAgICAgIHJlc3BvbnNlLnJlc3VsdHNbaV0gPSB4O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBmbGF0ID0gcmVzcG9uc2UucmVzdWx0cy5yZWR1Y2UoKGEsYikgPT4gYS5jb25jYXQoYiksIFtdKTtcclxuXHJcbiAgICByZXR1cm4geyBzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtyZXN1bHRzOmZsYXR9KSB9O1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgcmV0dXJuIHsgc3RhdHVzQ29kZTogNTAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShlcnIpfTtcclxuICB9XHJcbn07XHJcblxyXG5pbnRlcmZhY2UgTExDb29wQ3JlZGVudGlhbHMge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBiYXJjb2RlOiBzdHJpbmc7XHJcbiAgcGluOiBzdHJpbmc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlSW1hZ2VVcmwoaHJlZiA6IHN0cmluZykge1xyXG4gIGlmIChocmVmKSB7XHJcbiAgICB2YXIgbWF0Y2hlcyA9IC9cXC9yZWNvcmQ9KFthLXpBLVowLTldKyl+Ly5leGVjKGhyZWYpO1xyXG4gICAgaWYgKG1hdGNoZXMpIHtcclxuICAgICAgcmV0dXJuIGxsY29vcFVybChcIi9ib29ramFja2V0P3JlY2lkPVwiICsgbWF0Y2hlc1sxXSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzcGxpdFRpdGxlQW5kQWNrbm93bGVkZ2VtZW50cyhzIDogc3RyaW5nKSB7XHJcbiAgY29uc3Qgc2xhc2ggPSBzLmluZGV4T2YoXCIgLyBcIik7XHJcbiAgaWYgKHNsYXNoID49IDApIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRpdGxlOiBzLnN1YnN0cmluZygwLCBzbGFzaCksXHJcbiAgICAgIGFja25vd2xlZGdlbWVudHM6IHMuc3Vic3RyaW5nKHNsYXNoICsgMykuc3BsaXQoXCIgOyBcIilcclxuICAgIH07XHJcbiAgfVxyXG4gIHJldHVybiB7IHRpdGxlOiBzIH07XHJcbn0iXX0=